<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	
	<title>Strava Cycle Heatmap</title>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
	<script src="src/leaflet.ajax.min.js"></script>
	<script src="data/cycle_collisions.geojson" type="text/javascript"></script>
	<script src="data/cycle_collisions_KSI_14_only.geojson" type="text/javascript"></script>
	<script src="data/collision_clusters.geojson" type="text/javascript"></script>
	
 <style>
	body {
		padding: 0;
		margin: 0;
	}
	html, body, #map {
		height: 100%;
	}
</style>

</head>

<body>
  	<div id="map"></div>

	<script>
// Load base layers
  var OSM = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		maxZoom: 18,
		id: 'mapbox.dark',
		accessToken: 'pk.eyJ1IjoiYm9iaGFycGVyIiwiYSI6ImQwOTg1YTg2MTQzYzk3Mzc5MWVjYzFkZDQzN2M1NTUzIn0.mA2WO4WAZzh-qwoqN4QVjg'
	});	
	
  var Strava = L.tileLayer('http://globalheat.strava.com/tiles/cycling/color3/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: 'Data <a href="http://www.strava.com">Strava</a>',
	});
	
// Add collisions data as .GeoJSON layer with popup for each click event (a_type = severity of collision)
// Add clusters data (default layer), no events
  function onEachFeature(feature, layer) {
        if (feature.properties && feature.properties.a_type) {
        layer.bindPopup(feature.properties.a_type);
    	}
  }
  
  var collisionMarkerOptions = {
    stroke: false,
    radius: 8,
    fillColor: "#000",
    fillOpacity: 0.4
  };
  
  var polygonStyle = {
    opacity: 1,
	weight: 4,
	color: "red",
    fillColor: "red",
	fillOpacity: 0.86
  };
  
  var collisionsJson = L.geoJson(collisions, {
  	pointToLayer: function (feature, latlng) {
        	return L.circleMarker(latlng, collisionMarkerOptions);
  	},
  	onEachFeature : onEachFeature
  });
  
  var collisions14Json = L.geoJson(collisions14, {
  	pointToLayer: function (feature, latlng) {
        	return L.circleMarker(latlng, collisionMarkerOptions);
  	},
  	onEachFeature : onEachFeature
  });
  
  var clustersLayer = L.geoJson(clusters, {style: polygonStyle});
  
  var collisionsLayer = L.layerGroup([collisionsJson, collisions14Json]);
  
  var overlayMap = {
    "Collisions": collisionsLayer, 
	"Clusters": clustersLayer
  };
  
  var map = L.map('map', {
  layers: [OSM, Strava, clustersLayer]  
  });
  
  map.locate({setView: true, maxZoom: 16});
  
  L.control.layers(null, overlayMap, {collapsed: false, position: 'topleft'}).addTo(map);
  	
</script>  

</body>
</html>
