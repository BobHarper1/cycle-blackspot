<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Cycle Collider</title>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
	<link rel="stylesheet" href="leaflet-routing-machine.css" />
	<link rel="stylesheet" href="leaflet-control-geocoder.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
	<script src="leaflet.ajax.min.js"></script>
  	<script src="leaflet-routing-machine.js"></script>
  	<script src="lrm-mapbox-1.0.2.js"></script>
  	<script src="leaflet-control-geocoder.js"></script>
</head>

<body>
<p>introduction</p>
  	<div id="map" style="height: 800px"></div>

<script>
// Load Leaflet map, view set for Belfast City Centre
  var map = L.map('map').setView([54.597, -5.93], 13);

// Load OpenCycleMap
  L.tileLayer('http://b.tile.thunderforest.com/cycle/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: '<a href="http://leaftletjs.com">Leaflet</a>, ' + 
			'Data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Routing <a href="http://project-osrm.org/">OSRM</a>, ' +
			'Map &copy; <a href="http://www.thunderforest.com/">OpenCycleMap</a>',
	}).addTo(map);

// Add collisions data as .GeoJSON layer with popup for each click event
  function onEachFeature(feature, layer) {
        if (feature.properties && feature.properties.severity) {
        layer.bindPopup(feature.properties.severity);
    	}
  }
  
  var geojsonMarkerOptions = {
    radius: 12,
    fillColor: "#ff0000",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.6
  };
  
  var geojsonLayer = new L.GeoJSON.AJAX("cycle-collisions.geojson", {
  	pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);
  	},
  	onEachFeature : onEachFeature
    });
  
  geojsonLayer.addTo(map);

// Default route: from Belfast City Hall (54.597, -5.93) to Giant's Causeway (55.24, -6.51), add geocoder and Mapbox cycle router
  L.Routing.control({
    waypoints: [
        L.latLng(54.597, -5.93),
        L.latLng(55.24, -6.51)
    ],
    routeWhileDragging: true,
    geocoder: L.Control.Geocoder.nominatim(),
    router: new L.Routing.Mapbox('pk.eyJ1IjoiYm9iaGFycGVyIiwiYSI6ImQwOTg1YTg2MTQzYzk3Mzc5MWVjYzFkZDQzN2M1NTUzIn0.mA2WO4WAZzh-qwoqN4QVjg')
  }).addTo(map);

</script>  
</body>
</html>
